global:
  scrape_interval: 5s
  evaluation_interval: 5s
rule_files:
  - "/etc/prometheus/rules/prometheus_rules.yml"

scrape_configs:
  - job_name: 'clustergenie-core'
    metrics_path: '/metrics'
    # When running everything in docker-compose this will scrape the core-api service
    # When running the backend locally (not containerized) Prometheus can't resolve 'core-api'
    # so include host.docker.internal:8080 (macOS / Docker Desktop) as an alternate target.
    # Default for dev/test: scrape the backend running on the host (host.docker.internal).
    # If you run core-api inside docker-compose and want Prometheus to scrape the container
    # directly, replace this with ['core-api:8080'] or add it when the core-api container is present.
    static_configs:
      # Support multiple development / deployment layouts so Prometheus can find
      # the core-api regardless of how you run it (host vs container).
      # - When Prometheus runs inside docker-compose: the container DNS name is `core-api:8080`.
      # - When Prometheus runs on the host (or via Docker Desktop on macOS): use `host.docker.internal:8080`.
      # - When both Prometheus and core-api run on the host, `localhost:8080` will work.
      # Keep all three so scraping is robust in dev environments.
      - targets: ['host.docker.internal:8085', 'core-api:8080', 'localhost:8085']

  - job_name: 'prometheus'
    static_configs:
      # NOTE: Port 9090 should match PROMETHEUS_PORT in .env file
      - targets: ['localhost:9090']
